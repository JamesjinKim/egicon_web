# EG-ICON Dashboard PRD

**Product Requirements Document v3.0**  
**Date:** 2025-07-04  
**Project:** EG-ICON Real-time Dashboard System - 이중 멀티플렉서 구현 완료

---

## 1. 프로젝트 개요

### 1.1 제품명

EG-ICON Real-time Dashboard System

### 1.2 목적

이중 TCA9548A 멀티플렉서를 활용한 16채널 센서 데이터의 실시간 수집, 모니터링, 관리 시스템 구축

- 라즈베리파이 최적화 솔루션
- 이중 I2C 버스 관리 (Channel 1/Bus 0, Channel 2/Bus 1)
- 실시간 센서 스캔 및 테스트 기능
- egicon_dash 기반 전문적인 UI/UX
- 성능 최적화: 메모리 > 실시간성 > 응답속도

### 1.3 프로젝트 범위

**✅ 구현 완료된 기능들:**

- **하드웨어**: 이중 TCA9548A 멀티플렉서 시스템 (Channel 1/Bus 0: 8채널, Channel 2/Bus 1: 8채널)
- **소프트웨어**: 
  - 실시간 센서 모니터링 대시보드
  - 센서 설정 및 관리 페이지
  - 16채널 시각화 시스템
- **통신**: RESTful API + WebSocket 실시간 스트리밍
- **스캔 시스템**: 자동 센서 검색 및 타입 인식
- **테스트 기능**: 개별 센서 진단 및 상태 확인
- **UI/UX**: egicon_dash 기반 전문적인 디자인

### 1.4 목표 사용자

- IoT 시스템 개발자
- 센서 모니터링이 필요한 연구원
- 산업용 센서 관리자
- 라즈베리파이 기반 프로젝트 개발자

---

## 2. 시스템 아키텍처

### 2.1 전체 시스템 구조 (✅ 구현 완료)

```
┌─────────────────────┐    ┌──────────────────────┐    ┌─────────────────────┐
│     Browser         │◄──►│   FastAPI Server     │◄──►│     Hardware        │
│ (HTML/CSS/JS)       │    │    (Pure API)        │    │ (이중 TCA9548A 시스템) │
│ - 실시간 대시보드       │    │ - RESTful API        │    │ - Bus 0: 8채널        │
│ - 센서 설정 페이지      │    │ - WebSocket          │    │ - Bus 1: 8채널        │
│ - Chart.js 시각화    │     │ - 센서 스캔 API       │    │ - 16개 센서 관리       │
│ - 16채널 시각화       │     │ - 센서 테스트 API     │    │ - I2C 통신           │
│ - egicon_dash UI    │     │ - 이중 멀티플렉서 관리  │    │ - 센서 자동 인식       │
└─────────────────────┘    └──────────────────────┘    └─────────────────────┘
```

### 2.2 이중 멀티플렉서 하드웨어 구조 (✅ 구현 완료)

```
Raspberry Pi I2C Master
├── Channel 1 (I2C Bus 0) → TCA9548A #1 (Address: 0x70)
│   ├── Channel 0 → SHT40 센서 (0x44)
│   ├── Channel 1 → BME688 센서 (0x76)
│   ├── Channel 2 → BH1750 센서 (0x23)
│   ├── Channel 3 → 추가 센서
│   ├── Channel 4 → 추가 센서
│   ├── Channel 5 → 추가 센서
│   ├── Channel 6 → 추가 센서
│   └── Channel 7 → 추가 센서
│
└── Channel 2 (I2C Bus 1) → TCA9548A #2 (Address: 0x70)
    ├── Channel 0 → SHT40 센서 (0x44)
    ├── Channel 1 → BME688 센서 (0x76)
    ├── Channel 2 → BH1750 센서 (0x23)
    ├── Channel 3 → 추가 센서
    ├── Channel 4 → 추가 센서
    ├── Channel 5 → 추가 센서
    ├── Channel 6 → 추가 센서
    └── Channel 7 → 추가 센서
### 2.3 구현된 하드웨어 구성 (✅ 완료)

- **메인 컨트롤러**: 라즈베리파이 (I2C 활성화)
- **멀티플렉서**: TCA9548A 2개 (Channel 1/Bus 0, Channel 2/Bus 1)
- **지원 센서 타입**:
    - SHT40 (온도, 습도) - 0x44, 0x45
    - BME688 (온도, 습도, 압력, 공기질) - 0x76, 0x77
    - BH1750 (조도) - 0x23, 0x5C
    - SDP810 (차압) - 0x25
    - VL53L0X (거리) - 0x29
- **통신**: I2C 프로토콜 (이중 버스 지원)

### 2.4 구현된 소프트웨어 구성 (✅ 완료)

### 주요 특징

- **이중 멀티플렉서 관리**: Channel 1/Bus 0, Channel 2/Bus 1 독립적 제어
- **실시간 센서 스캔**: 자동 센서 검색 및 타입 인식
- **센서 테스트 기능**: 개별 센서 진단
- **egicon_dash UI**: 전문적인 대시보드 디자인
- **성능 최적화**: 메모리 > 실시간성 > 응답속도
- **16채널 시각화**: 2×8 그리드 실시간 표시
- **반응형 UI**: 모바일/태블릿/데스크톱 지원

#### 백엔드 스택 (✅ 구현 완료)

- **Framework**: FastAPI
- **Real-time**: WebSocket 실시간 스트리밍
- **API**: RESTful 센서 관리 API
- **Mock System**: 하드웨어 없이 테스트 가능
- **센서 스캔**: 이중 멀티플렉서 스캔 시스템

#### 프론트엔드 스택 (✅ 구현 완료)

- **메인 대시보드**: 실시간 센서 모니터링
- **설정 페이지**: 센서 스캔 및 관리
- **Charts**: Chart.js 기반 실시간 차트
- **UI Framework**: egicon_dash 기반 디자인
- **JavaScript**: ES6+ 모듈화 구조

---

## 3. 구현된 프로젝트 구조 (✅ 완료)

### 3.1 실제 구현된 폴더 구조

```
egicon_web/
│
├── main.py                    # FastAPI 서버 (✅ 구현 완료)
├── requirements.txt           # 프로덕션 의존성
├── requirements-dev.txt       # 개발 의존성
├── README.md                  # 업데이트된 프로젝트 문서
├── PRD.md                    # 업데이트된 제품 요구사항 문서
│
├── frontend/ (✅ 구현 완료)
│   ├── index.html            # 메인 대시보드
│   ├── settings.html         # 센서 설정 페이지 (신규)
│   ├── style.css             # 통합 스타일시트
│   ├── dashboard.js          # 대시보드 JavaScript
│   └── settings.js           # 설정 페이지 JavaScript (신규)
│
├── egicon_dash/              # 참고 샘플 프로젝트
│   └── (참고용 egicon_dash 샘플 코드)
│
└── mvenv/                    # Python 가상환경
```

### 3.2 구현된 주요 파일들

#### 백엔드 파일 (✅ 구현 완료)

- **main.py**: 
  - FastAPI 서버 메인 애플리케이션
  - 이중 멀티플렉서 스캔 API
  - 센서 테스트 API
  - WebSocket 실시간 스트리밍
  - Mock 데이터 시스템

#### 프론트엔드 파일 (✅ 구현 완료)

- **index.html**: 
  - 실시간 센서 모니터링 대시보드
  - 센서 그룹별 표시 (SHT40, BME688, 기타)
  - Chart.js 기반 실시간 차트
  - egicon_dash 기반 UI 디자인

- **settings.html**: 
  - 이중 멀티플렉서 시각화
  - 16채널 그리드 (2×8)
  - 센서 스캔 기능
  - 센서 테스트 기능

- **style.css**: 
  - egicon_dash 기반 통합 스타일시트
  - 반응형 디자인
  - 센서 상태별 색상 구분
  - 버스별 색상 구분 (Bus 0: 파란색, Bus 1: 빨간색)

- **dashboard.js**: 
  - 실시간 대시보드 관리
  - WebSocket 연결 및 데이터 처리
  - Chart.js 차트 관리
  - 센서 그룹별 데이터 표시

- **settings.js**: 
  - 센서 스캔 관리
  - 이중 멀티플렉서 제어
  - 센서 테스트 기능
  - egicon_dash 스타일 UI 관리
---

## 4. 구현된 주요 기능들 (✅ 완료)

### 4.1 이중 멀티플렉서 관리 시스템

- **Channel 1 관리**: TCA9548A #1 (I2C Bus 0, 8채널)
- **Channel 2 관리**: TCA9548A #2 (I2C Bus 1, 8채널)
- **독립적 스캔**: 버스별 개별 스캔 가능
- **실시간 상태**: 채널별 센서 연결 상태 표시
- **색상 구분**: Channel 1/Bus 0 (파란색), Channel 2/Bus 1 (빨간색)

### 4.2 센서 스캔 및 관리

- **자동 센서 스캔**: I2C 주소 범위 자동 스캔
- **센서 타입 인식**: 주소 기반 자동 센서 타입 식별
- **실시간 진행률**: egicon_dash 스타일 진행률 표시
- **스캔 결과 테이블**: 발견된 센서 상세 정보 표시
- **개별 센서 테스트**: 센서별 진단 및 상태 확인

### 4.3 실시간 대시보드

- **WebSocket 스트리밍**: 2초 간격 실시간 업데이트
- **센서 그룹별 표시**: SHT40, BME688, 기타 센서 그룹
- **Chart.js 차트**: 30개 데이터 포인트 실시간 차트
- **성능 최적화**: 메모리 우선 최적화

### 4.4 사용자 인터페이스

- **egicon_dash 기반**: 전문적인 대시보드 디자인
- **반응형 디자인**: 모바일/태블릿/데스크톱 지원
- **사이드바 네비게이션**: 확장/축소 가능
- **토스트 알림**: 사용자 친화적 알림 시스템

### 4.5 API 엔드포인트

```
✅ 구현 완료된 API들:

# 센서 관리
GET  /api/sensors                    # 전체 센서 목록
GET  /api/sensors/status             # 센서 상태 조회
POST /api/sensors/scan-all           # 통합 센서 스캔
POST /api/sensors/scan-dual-mux      # 이중 멀티플렉서 스캔
POST /api/sensors/scan-bus/{bus}     # 단일 버스 스캔
POST /api/sensors/test               # 센서 테스트

# 실시간 데이터
WebSocket: /ws/realtime              # 실시간 센서 데이터

# 페이지 서빙
GET  /                              # 메인 대시보드
GET  /settings                      # 센서 설정 페이지
GET  /style.css                     # CSS 파일
GET  /dashboard.js                  # 대시보드 JS
GET  /settings.js                   # 설정 페이지 JS
```

---

## 5. 성능 최적화 및 특징

### 5.1 성능 최적화 우선순위 (✅ 적용 완료)

1. **메모리 사용량 최적화**
   - 차트 데이터 포인트 30개 제한
   - WebSocket 연결 관리
   - 불필요한 DOM 조작 최소화

2. **실시간성 보장**
   - 2초 간격 WebSocket 업데이트
   - 비동기 센서 스캔
   - 즉시 응답 UI 피드백

3. **응답 속도 향상**
   - Mock 데이터 fallback
   - 배치 처리 최적화
   - 캐시 전략 적용

### 5.2 하드웨어 없이 테스트 가능 (✅ 구현 완료)

- **Mock 센서 데이터**: 실제 센서 없이 테스트 가능
- **시뮬레이션**: 16채널 센서 시뮬레이션
- **개발 환경**: Mac/Windows에서 개발 가능

---

## 6. 향후 개발 계획

### 6.1 Phase 2 (중장기)

- **실제 I2C 하드웨어 연결**: smbus2 라이브러리 통합
- **데이터 저장**: SQLite 기반 센서 데이터 저장
- **알람 시스템**: 임계값 기반 알람
- **데이터 백업**: 센서 데이터 백업 및 복원

### 6.2 Phase 3 (장기)

- **다중 멀티플렉서**: 3개 이상 멀티플렉서 지원
- **원격 모니터링**: 클라우드 연동
- **모바일 앱**: 전용 모바일 애플리케이션
- **AI 분석**: 센서 데이터 패턴 분석

---

## 7. 업데이트 로그

### v3.1 (2025-07-05) - UI/UX 개선 및 진동센서 개발 시작

- ✅ 센서 상태 표시 시스템 개선 (SPS30 위치 조정)
- ✅ 사이드바 메뉴 아이콘 업데이트 (🌬️, 📳)
- ✅ Chart.js 오류 복구 시스템 구현
- ✅ 동적 센서 카운트 표시 개선
- ✅ 미세먼지센서 페이지 네비게이션 활성화
- ✅ 위젯 레이아웃 최적화 (아이콘 겹침 해결)
- ✅ Font Awesome 아이콘 누락 문제 해결
- 🔄 IIS3DWB 진동센서 SPI 통신 기반 구축
- 🔄 하드웨어 연결 검증 진행 중

### v3.0 (2025-07-04) - 이중 멀티플렉서 구현 완료

- ✅ 이중 TCA9548A 멀티플렉서 시스템 구현
- ✅ 16채널 센서 관리 시스템 구축
- ✅ egicon_dash 기반 UI 적용
- ✅ 센서 스캔 및 테스트 기능 구현
- ✅ 실시간 대시보드 완성
- ✅ 설정 페이지 신규 개발
- ✅ API 엔드포인트 확장
- ✅ 성능 최적화 적용
- ✅ README.md 및 PRD.md 업데이트

### 3.2 SOLID 원칙 적용

#### Single Responsibility Principle (SRP)

- `sensor_service.py`: 센서 관리만 담당
- `data_service.py`: 데이터 처리만 담당
- `multiplexer.py`: TCA9548A 제어만 담당

#### Open/Closed Principle (OCP)

- `sensor_factory.py`: 새 센서 추가 시 확장 가능
- `base_sensor.py`: 센서 인터페이스 정의로 확장 지원

#### Liskov Substitution Principle (LSP)

- 모든 센서 클래스는 `BaseSensor`를 상속받아 교체 가능

#### Interface Segregation Principle (ISP)

- `base_sensor.py`: 센서 전용 인터페이스만 정의
- 불필요한 메서드 강제 구현 방지

#### Dependency Inversion Principle (DIP)

- 서비스 레이어가 하드웨어 추상화에 의존
- 구체적인 구현체에 직접 의존하지 않음

---

## 4. 핵심 기능 요구사항

### 4.1 센서 데이터 수집

- **수집 주기**: 1-60초 설정 가능
- **지원 센서**:
    - BME688 (온도, 습도, 압력, 공기질) - 7개 연동 완료
    - SPS30 (미세먼지) - UART 연동 완료
    - BH1750 (조도) - I2C 동적 스캔 완료
    - IIS3DWB (진동) - SPI 통신 개발 중
    - 차압 센서 (예정)
- **데이터 형식**: JSON
- **에러 핸들링**: 센서 통신 실패 시 자동 재연결 및 재시도

### 4.2 API 엔드포인트

#### RESTful API

```http
GET  /api/sensors/status         # 모든 센서 상태 조회
GET  /api/sensors/list           # 센서 목록 조회
GET  /api/sensors/{sensor_id}    # 특정 센서 데이터 조회
GET  /api/sensors/history        # 히스토리 데이터 조회
POST /api/sensors/config         # 센서 설정 변경
GET  /api/health                 # 시스템 헬스체크
```

#### WebSocket

```
WebSocket /ws/realtime          # 실시간 데이터 스트림
WebSocket /ws/sensor/{sensor_id} # 특정 센서 실시간 데이터
```

### 4.3 대시보드 기능

#### 실시간 모니터링

- **실시간 차트**: 온도, 습도, 압력, 조도, 진동 그래프
- **센서 상태**: 온라인/오프라인 상태 표시
- **데이터 업데이트**: WebSocket을 통한 실시간 업데이트

#### 데이터 관리

- **히스토리 조회**: 과거 데이터 조회 및 차트 표시
- **알람 시스템**: 임계값 초과 시 시각적 알림
- **데이터 내보내기**: CSV, JSON 형식으로 내보내기

#### 사용자 인터페이스

- **반응형 디자인**: 다양한 화면 크기 지원
- **직관적 UI**: 사용하기 쉬운 인터페이스
- **성능 최적화**: 라즈베리파이4에서 부드러운 동작

---

## 5. 성능 및 제약사항

### 5.1 성능 목표

#### 라즈베리파이4 최적화

- **메모리 사용량**: 50MB 이하
- **CPU 사용률**: 평상시 20% 이하
- **응답 시간**: API 응답 100ms 이하
- **실시간 지연**: WebSocket 지연 50ms 이하

#### 네트워크 성능

- **동시 연결**: 최대 10개 클라이언트
- **데이터 전송**: 초당 최대 16개 센서 데이터
- **대역폭**: 최소 1Mbps

### 5.2 안정성 요구사항

- **가용성**: 99.9% 업타임 목표
- **에러 복구**: 센서 오류 시 자동 재연결
- **데이터 무결성**: 센서 데이터 검증 및 저장
- **로그 관리**: 시스템 로그 및 에러 로그 기록

### 5.3 확장성 고려사항

- **센서 추가**: 새로운 센서 타입 쉽게 추가 가능
- **기능 확장**: 새로운 API 기능 추가 용이
- **성능 확장**: 더 많은 센서 지원을 위한 구조

---

## 6. 데이터 모델

### 6.1 센서 데이터 구조

```json
{
  "sensor_id": "hub1_channel_0",
  "sensor_type": "BME680",
  "timestamp": "2025-01-03T12:00:00Z",
  "data": {
    "temperature": 25.6,
    "humidity": 60.2,
    "pressure": 1013.25
  },
  "status": "online",
  "error": null
}
```

### 6.2 센서 설정 구조

```json
{
  "sensor_id": "hub1_channel_0",
  "sensor_type": "BME680",
  "hub_id": 0,
  "channel": 0,
  "address": "0x77",
  "update_interval": 5,
  "enabled": true,
  "thresholds": {
    "temperature_max": 50.0,
    "temperature_min": 0.0,
    "humidity_max": 90.0,
    "humidity_min": 10.0
  }
}
```

---

## 7. 개발 일정

### Phase 1: 백엔드 개발 (2주)

**Week 1:**

- [x] 프로젝트 구조 설정
- [ ] SOLID 원칙 기반 클래스 설계
- [ ] 기존 BME680 코드 리팩토링
- [ ] TCA9548A 멀티플렉서 클래스 구현

**Week 2:**

- [ ] FastAPI 서버 구축
- [ ] RESTful API 구현
- [ ] WebSocket 실시간 통신 구현
- [ ] 데이터베이스 연동

### Phase 2: 프론트엔드 개발 (1주)

- [ ] Pure HTML/CSS 대시보드 구조
- [ ] Vanilla JavaScript 로직 구현
- [ ] Chart.js 차트 연동
- [ ] WebSocket 클라이언트 구현
- [ ] 반응형 UI 구현

### Phase 3: 통합 및 테스트 (1주)

- [ ] 하드웨어-소프트웨어 연동 테스트
- [ ] 성능 최적화
- [ ] 라즈베리파이4 배포 테스트
- [ ] 사용자 테스트 및 피드백 반영

---

## 8. 리스크 및 대응 방안

### 8.1 기술적 리스크

|리스크|영향도|확률|대응 방안|
|---|---|---|---|
|센서 통신 불안정|높음|중간|재연결 로직, 에러 핸들링 강화|
|라즈베리파이 성능 부족|중간|낮음|코드 최적화, 메모리 관리|
|WebSocket 연결 끊김|중간|중간|자동 재연결, 백오프 전략|

### 8.2 일정 리스크

- **지연 요인**: 하드웨어 연동 복잡성
- **대응 방안**: 단계별 테스트, 점진적 개발

---

## 9. 성공 기준

### 9.1 기능적 성공 기준

- [ ] 16개 센서 동시 모니터링 가능
- [ ] 실시간 데이터 시각화 구현
- [ ] 웹 대시보드 정상 동작
- [ ] API 모든 엔드포인트 정상 동작

### 9.2 비기능적 성공 기준

- [ ] 라즈베리파이4에서 메모리 50MB 이하 사용
- [ ] API 응답시간 100ms 이하
- [ ] 99% 이상 시스템 안정성
- [ ] 사용자 친화적 인터페이스

---

## 10. 결론

본 프로젝트는 TCA9548A 멀티플렉서를 활용한 다중 센서 모니터링 시스템으로, 라즈베리파이4 환경에 최적화된 경량 웹 대시보드를 목표로 합니다. SOLID 원칙을 기반으로 한 확장 가능한 아키텍처와 Pure HTML/CSS/JS를 통한 성능 최적화를 통해 안정적이고 효율적인 시스템을 구축할 예정입니다.

---

**문서 버전**: v2.1  
**최종 수정일**: 2025-01-03  
**작성자**: Development Team  
**승인자**: Project Manager